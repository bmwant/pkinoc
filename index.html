<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>pkinoc</title>

    <link rel="stylesheet" href="/node_modules/siimple/dist/siimple.min.css">
    <link rel="stylesheet" href="/static/css/style.css">

    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/jsbarcode/dist/JsBarcode.all.min.js"></script>
    <script src="/node_modules/dom-to-image/dist/dom-to-image.min.js"></script>
    <script src="/node_modules/file-saver/FileSaver.min.js"></script>
    <script src="/node_modules/moment/moment.js"></script>
</head>
<body>
<div  id="header" class="siimple-navbar siimple-navbar--blue siimple-navbar--fluid">
  <div class="siimple-layout--left">
    <a href="/" class="siimple-navbar-title">Generate your own tickets</a>
  </div>
  <div class="siimple-layout--right">
    <a href="https://github.com/bmwant/pkinoc" class="siimple-navbar-link" target="_blank">Github</a>
    <a href="http://bmwlog.pp.ua/" class="siimple-navbar-link" target="_blank">Blog</a>
  </div>
</div>
<div class="siimple-grid siimple-content">
  <div class="siimple-grid-row">
    <div class="siimple-grid-col siimple-grid-col--12">
      <div id="data-form" class="siimple-form text-center">
        <fieldset>
          <label class="siimple-label">URL to a movie:</label>
          <input id="ticket-url" type="text" class="siimple-input" placeholder="">
          <div id="ticket-button" class="siimple-btn siimple-btn--blue">Get a ticket</div>
        </fieldset>
        <fieldset>
          <label class="siimple-label">Code:</label>
          <input id="target-value" value="2070120888749" type="text" class="siimple-input" placeholder="" maxlength="13">
          <div id="generate-button" class="siimple-btn siimple-btn--green">Generate</div>
          <div id="download-button" class="siimple-btn siimple-btn--teal">Download picture</div>
        </fieldset>
      </div>
    </div>
  </div>
  <div class="siimple-grid-row">
    <div class="siimple-grid-col siimple-grid-col--8">
      <div id="ticket" class="img-overlay-wrap">
        <img width="360" src="/static/img/blank.jpg">
        <svg id="barcode"></svg>
        <div id="seat-num" class="num">2</div>
        <div id="row-num" class="num">5</div>
        <div id="technology">Cinetech+2D</div>
        <div id="hall">Зал 5</div>
        <div id="name">НІЧНІ ІГРИ</div>
      </div>
        <!-- 234x125 -- 300, height: 88 -->
        <!-- 281x150 -- 360, height: 106 -->
      <div id="test-ticket">
        <img width="360" src="/static/img/test.jpg">

      </div>
    </div>
  </div>
</div>
<script>

  function generateBarcode(value) {
    JsBarcode("#barcode", value, {
      format: "ean13",
      lineColor: "#1e1e1e",
      background: "rgba(1,1,1,0)",
      width: 2,
      height: 88,
      displayValue: false
    });
  }

  function setValues() {
    var nameElem = $('#name');
    var width = nameElem.width();
    var current = parseInt(nameElem.css('left')),
      newPosition = current - width/2;
    // console.log(width, current);
    nameElem.css({'left': newPosition + 'px'});
  }

  $(function() {

    $("#generate-button").click(function() {
      generateBarcode($("#target-value").val());
      $("#barcode").attr('style','transform: scale(1.48);');
    });

    $("#download-button").click(function() {
      var node = document.getElementById('ticket');

      domtoimage.toBlob(node).then(function(blob) {
        window.saveAs(blob, 'my-node.png');
      }).catch(function (error) {
        console.error('oops, something went wrong!', error);
      });
    });

    setValues();
  });
</script>
</body>
</html>
